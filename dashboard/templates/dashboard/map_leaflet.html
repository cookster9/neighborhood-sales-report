{% extends "dashboard/base.html" %}
{% block content %}
<div class="sub-header">
    <p>Nashville home sales in the last 6 weeks</p>
</div>
<div id="full-container" class="full-container">
    <div class="outer-container">
        <div id="map" class="map-container"></div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <div class="checkbox-container">
        <ul>
        {% for key, value in groups.items %}
        <li>
            <input class="checkbox-input" type="checkbox" id={{key}} name="{{value.name}}" value="yes" onchange="toggleNeighborhoodVisibility(this)" checked>
        <label for="{{value.name}}">
             {{value.name}}
        </label>
        </li>
        {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}

{% block mapscript %}
<script>
function toggleNeighborhoodVisibility(obj) {
  if($(obj).is(":checked")){
    //alert("Yes checked"); //when checked
    markerAry[obj.id].addTo(map);
    markerAry[10*obj.id].map(a => a.addTo(map));
  }else{
    //alert("Not checked"); //when not checked
    markerAry[obj.id].remove();
    markerAry[10*obj.id].map(a => a.remove());
  }
}
var icon0 = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-black.png',
  shadowUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});var icon1 = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
  shadowUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});
var icon2 = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png',
  shadowUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});
var icon3 = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
  shadowUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});
var icon4 = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-grey.png',
  shadowUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});
var icon5 = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-orange.png',
  shadowUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});
var icon6 = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
  shadowUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});
var icon7 = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-violet.png',
  shadowUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});
var iconHover = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-gold.png',
  shadowUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-shadow.png',
  iconSize: [30, 46],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [46, 46]
});
var map = L.map('map').setView([{{nash_lat}}, {{nash_long}}], 13);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);
var markerAry = {};
{% for key, value in groups.items %}
    var marker{{key}} = L.marker([{{value.lat}}, {{value.long}}], {icon: icon{{value.icon_num}}}).addTo(map);
    markerAry[{{key}}]=marker{{key}};
    var array{{key}} = new Array();
    markerAry[10*{{key}}]=array{{key}};
    marker{{key}}.on('mouseover', function()
        {
            marker{{key}}.setIcon(iconHover);
            array{{key}}.map(a => a.setStyle({fillColor: 'yellow', radius: 40}));
        });
    marker{{key}}.on('mouseout', function()
        {
            marker{{key}}.setIcon(icon{{value.icon_num}});
            array{{key}}.map(a => a.setStyle({fillColor: 'blue', radius: 30}));
        });
    marker{{key}}.bindTooltip("{{value.name}}");
    var table_html = '';
    table_html = '<table><tr><th>Address</th><th>Sale Date</th><th>Sale Price</th><th>Sq Ft</th></tr>';
    {% for house_dict in value.house_list %}
        var circle{{house_dict.reis_id}} = L.circle([{{house_dict.lat}}, {{house_dict.long}}], {
                color: 'blue',
                fillOpacity: 0.5,
                radius: 30, weight: 2,
                title: '{{house_dict.address}}'
            })
            .bindPopup(
            "{{house_dict.address}}<br>{{house_dict.sale_date}}<br>{{house_dict.sale_price}}<br>{{value.name}}")
            .bindTooltip('{{house_dict.address}}')
            .addTo(map);
        array{{key}}.push(circle{{house_dict.reis_id}});
        table_html = table_html + '<tr><td>'+'{{house_dict.address}}'+'</td><td>'+'{{house_dict.sale_date}}'+'</td><td>'+'{{house_dict.sale_price}}'+'</td><td>'+'{{house_dict.square_footage}}'+'</td></tr>'
    {% endfor %}
    table_html = table_html+'</table>';
    marker{{key}}.bindPopup(table_html, {offset: [0, -75]});

{% endfor %}
</script>
{% endblock %}